# Mise configuration for cascette-rs project
# Rust workspace implementing Blizzard's NGDP/CASC systems

[_]
project_description = "NGDP/CASC implementation in Rust - binary format parsers, cryptographic operations, caching, protocol clients, and Ribbit server"

# Environment variables
[env]
RUST_BACKTRACE = "1"

# Tool versions
[tools]
actionlint = "latest"
"cargo:cargo-deny" = "0.19.0"
"cargo:cargo-llvm-cov" = "0.6"
"cargo:cargo-nextest" = "0.9.127"
"cargo:flamegraph" = "0.6"
"npm:markdownlint-cli2" = "0.20.0"
mdbook = "latest"
rust = { version = "1.92", profile = "default" }

# Task definitions
[tasks.fmt]
description = "Format all code"
run = "cargo fmt --all"

[tasks.fmt-check]
description = "Check formatting without changes"
run = "cargo fmt --all -- --check"

[tasks.lint]
description = "Run markdown and GitHub Actions linting"
run = "markdownlint-cli2 '**/*.md' && actionlint"

[tasks.clippy]
description = "Run clippy linter"
run = "cargo clippy --workspace --all-targets --all-features"

[tasks.test]
description = "Run library unit tests only"
run = "cargo test --lib --workspace"

[tasks.test-all]
description = "Run all tests with all features"
run = "cargo test --workspace --all-features"

[tasks.test-ci]
description = "CI-optimized test run with nextest"
run = "cargo nextest run --profile ci --all-features --workspace"

[tasks.docs]
description = "Build Rust API documentation"
run = "cargo doc --workspace --no-deps"

[tasks.docs-build]
description = "Build mdBook documentation"
run = "mdbook build docs"

[tasks.docs-serve]
description = "Serve mdBook documentation locally"
run = "mdbook serve docs"

[tasks.check]
description = "Type checking for all targets"
run = "cargo check --workspace --all-targets --all-features"

[tasks.check-wasm]
description = "Check WASM compatibility for crypto and formats crates"
run = "cargo check --target wasm32-unknown-unknown -p cascette-crypto && cargo check --target wasm32-unknown-unknown -p cascette-formats"

[tasks.deny]
description = "Dependency security and license audit"
run = "cargo deny check --all-features"

[tasks.clean]
description = "Clean build artifacts"
run = "cargo clean"

[tasks.ci]
description = "Full CI quality gate (format, lint, test)"
run = "cargo fmt --all -- --check && cargo clippy --workspace --all-targets && cargo nextest run --profile ci --workspace"

[tasks.quality]
description = "Full quality check (format, lint, test, docs, wasm, deny)"
run = "cargo fmt --all -- --check && cargo clippy --workspace --all-targets && cargo nextest run --profile ci --workspace && cargo doc --workspace --no-deps && cargo check --target wasm32-unknown-unknown -p cascette-crypto && cargo check --target wasm32-unknown-unknown -p cascette-formats && cargo deny check --all-features && markdownlint-cli2 '**/*.md' && actionlint"

[tasks.run-ribbit]
description = "Run Ribbit server"
run = "cargo run -p cascette-ribbit"

# Shell aliases (active in this directory)
[shell_alias]
gs = "git status"
ga = "git add"
gc = "git commit"
gp = "git push"
gd = "git diff"
gl = "git log --oneline -10"
